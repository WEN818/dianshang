# 本地文件上传部署指南

## 📋 服务器信息
- **服务器地址**：`114.132.150.59`
- **用户名**：`ubuntu`
- **数据库密码**：`wkm20040818@`

---

## 方法一：使用 SCP 上传（Windows PowerShell）

### 步骤 1：打开 PowerShell
1. 按 `Win + X`，选择"Windows PowerShell"或"终端"
2. 导航到项目目录（如果不在的话）：
   ```powershell
   cd D:\Software\dianshang
   ```

### 步骤 2：上传项目文件
在 PowerShell 中执行以下命令：

```powershell
# 上传整个 network-homework 文件夹到服务器
scp -r network-homework ubuntu@114.132.150.59:/opt/
```

**说明**：
- `-r`：递归上传整个文件夹
- `network-homework`：本地项目文件夹名称
- `ubuntu@114.132.150.59`：服务器用户名和IP
- `/opt/`：服务器上的目标目录

### 步骤 3：输入密码
系统会提示输入密码，输入您的服务器密码（输入时不会显示，直接输入后按回车）

### 步骤 4：等待上传完成
上传时间取决于网络速度，通常需要几分钟。

---

## 方法二：使用 WinSCP（图形界面，推荐新手）

### 步骤 1：下载 WinSCP
1. 访问：https://winscp.net/
2. 下载并安装 WinSCP

### 步骤 2：连接服务器
1. 打开 WinSCP
2. 填写连接信息：
   - **文件协议**：选择 `SFTP`
   - **主机名**：`114.132.150.59`
   - **端口号**：`22`
   - **用户名**：`ubuntu`
   - **密码**：您的服务器密码
3. 点击"登录"
4. 首次连接会提示保存密钥，点击"是"

### 步骤 3：上传文件
1. 左侧窗口：选择本地项目文件夹 `D:\Software\dianshang\network-homework`
2. 右侧窗口：导航到服务器的 `/opt/` 目录
3. 将左侧的 `network-homework` 文件夹拖拽到右侧的 `/opt/` 目录
4. 等待上传完成

---

## 方法三：使用压缩包上传（适合大文件或网络不稳定）

### 步骤 1：压缩项目文件
在本地，将 `network-homework` 文件夹压缩为 ZIP 文件：
- 右键点击 `network-homework` 文件夹
- 选择"发送到" → "压缩(zipped)文件夹"
- 生成 `network-homework.zip`

### 步骤 2：上传压缩包
使用 SCP 或 WinSCP 上传压缩包：

**SCP 方式**：
```powershell
scp network-homework.zip ubuntu@114.132.150.59:/opt/
```

**WinSCP 方式**：
直接拖拽 `network-homework.zip` 到服务器的 `/opt/` 目录

### 步骤 3：在服务器上解压
SSH 连接到服务器后执行：

```bash
# 进入目录
cd /opt

# 解压文件
sudo unzip network-homework.zip -d network-homework

# 如果系统没有 unzip，先安装
# sudo apt install -y unzip

# 设置权限
sudo chown -R ubuntu:ubuntu network-homework
```

---

## 部署步骤（上传完成后）

### 步骤 1：SSH 连接到服务器
```powershell
ssh ubuntu@114.132.150.59
```

输入密码后连接成功。

### 步骤 2：进入项目目录
```bash
cd /opt/network-homework
```

### 步骤 3：检查文件是否完整
```bash
ls -la
```

应该能看到以下文件：
- `compose.yaml`
- `Dockerfile`
- `pom.xml`
- `src/`
- 等等...

### 步骤 4：确认数据库密码配置
```bash
# 查看配置文件
cat compose.yaml | grep MYSQL_PASSWORD
```

应该显示：`MYSQL_PASSWORD=wkm20040818@`

### 步骤 5：检查 Docker 是否安装
```bash
docker --version
docker-compose --version
```

如果未安装，参考《网络部署指南.md》第三部分安装 Docker。

### 步骤 6：部署应用
```bash
# 给部署脚本添加执行权限
chmod +x deploy.sh

# 运行部署脚本
./deploy.sh
```

或者手动部署：
```bash
# 停止旧容器（如果有）
docker-compose down

# 构建并启动容器
docker-compose up -d --build
```

### 步骤 7：等待服务启动
部署需要几分钟时间，请耐心等待。

### 步骤 8：检查服务状态
```bash
# 查看容器状态
docker-compose ps

# 查看应用日志
docker-compose logs -f app
```

看到 `Started NetworkHomeworkApplication` 表示启动成功。

### 步骤 9：测试访问
在浏览器中访问：
```
http://114.132.150.59:8080
```

如果能看到登录页面，说明部署成功！

---

## 常见问题

### Q1: SCP 上传失败，提示 "Permission denied"
**解决方法**：
1. 确认服务器密码正确
2. 确认服务器已开放 22 端口（SSH）
3. 尝试使用 WinSCP

### Q2: 上传速度很慢
**解决方法**：
1. 使用压缩包方式上传（方法三）
2. 检查网络连接
3. 如果文件很大，可以考虑先上传核心文件，其他文件后续补充

### Q3: 上传后文件权限问题
**解决方法**：
```bash
# 在服务器上执行
cd /opt/network-homework
sudo chown -R ubuntu:ubuntu .
chmod +x deploy.sh
```

### Q4: 部署时 Docker 构建失败
**解决方法**：
1. 检查网络连接
2. 配置 Docker 镜像加速器（参考部署指南）
3. 查看详细日志：`docker-compose logs app`

---

## 快速部署命令总结

```bash
# 1. 连接服务器
ssh ubuntu@114.132.150.59

# 2. 进入项目目录
cd /opt/network-homework

# 3. 检查配置
cat compose.yaml | grep MYSQL_PASSWORD

# 4. 部署
chmod +x deploy.sh
./deploy.sh

# 5. 查看状态
docker-compose ps
docker-compose logs -f app
```

---

## 后续更新代码

如果后续需要更新代码：

1. **本地修改代码后**，重新上传：
   ```powershell
   # 只上传修改的文件（更快）
   scp -r network-homework/src ubuntu@114.132.150.59:/opt/network-homework/
   ```

2. **在服务器上重新部署**：
   ```bash
   cd /opt/network-homework
   docker-compose up -d --build
   ```

---

**祝您部署顺利！** 🚀

